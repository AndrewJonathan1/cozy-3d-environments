<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simple Desk Setup</title>
    <style>
        body { margin: 0; background: #222; overflow: hidden; }
        
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            color: #ffffff;
        }
        
        .loading-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px #ffffff;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .loading-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #888888, #cccccc);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #ffffff;
        }
        
        .loading-text {
            font-size: 0.9rem;
            opacity: 0.8;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <div class="loading-title">🌙 INITIALIZING LUNAR WORKSPACE 🌙</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-text" id="loadingText">Loading environment...</div>
    </div>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.178.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.178.0/examples/jsm/"
        }
    }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        
        // Scene setup with space background
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a); // Deep space black
        
        // Create starfield
        const starGeometry = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPositions = new Float32Array(starCount * 3);
        
        for (let i = 0; i < starCount * 3; i++) {
            starPositions[i] = (Math.random() - 0.5) * 200;
        }
        
        starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
        const starMaterial = new THREE.PointsMaterial({ 
            color: 0xffffff, 
            size: 0.5,
            transparent: true,
            opacity: 1.0,
            sizeAttenuation: false // Keep stars same size regardless of distance
        });
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);
        
        // Camera positioned like sitting at a desk
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2.5, 4.0); // Much higher and farther back for better overview
        
        // Mouse controls
        let mouseX = 0, mouseY = 0;
        let targetLookX = 0, targetLookY = 1.1; // Look down at desk more
        
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX - window.innerWidth / 2) / window.innerWidth;
            mouseY = (event.clientY - window.innerHeight / 2) / window.innerHeight;
            
            // Convert mouse movement to look targets (MUCH MORE NARROW)
            targetLookX = mouseX * 0.3; // Very subtle left/right panning
            targetLookY = 1.1 + (mouseY * -0.1); // Very subtle up/down with bias toward desk
        });
        
        // WebGL renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        // CSS3D renderer
        const css3dRenderer = new CSS3DRenderer();
        css3dRenderer.setSize(window.innerWidth, window.innerHeight);
        css3dRenderer.domElement.style.position = 'absolute';
        css3dRenderer.domElement.style.top = '0';
        css3dRenderer.domElement.style.pointerEvents = 'none';
        document.body.appendChild(css3dRenderer.domElement);
        
        // Space lighting - cool and minimal
        const ambientLight = new THREE.AmbientLight(0x404080, 0.3); // Cool blue ambient
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0x8080ff, 0.5); // Cool directional light from stars
        directionalLight.position.set(10, 10, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        
        // Desk work light - warm contrast in the cold space
        const deskLight = new THREE.PointLight(0xffaa66, 1.2, 5);
        deskLight.position.set(0, 2, 0); // Above the desk
        deskLight.castShadow = true;
        scene.add(deskLight);
        
        // Load wooden table
        const loader = new GLTFLoader();
        loader.load(
            './objects/wooden_table_02_4k.gltf/wooden_table_02_4k.gltf',
            function (gltf) {
                console.log('Table loaded');
                document.getElementById('loadingText').textContent = 'Loading complete!';
                document.getElementById('loadingProgress').style.width = '100%';
                
                // Hide loading screen after a brief delay
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
                
                const table = gltf.scene;
                table.position.set(0, 0, 1.5); // Table closer to camera
                table.scale.set(1.5, 1.5, 1.5);
                table.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });
                scene.add(table);
            },
            function (progress) {
                if (progress.total > 0) {
                    const percentage = Math.min((progress.loaded / progress.total) * 100, 100);
                    console.log('Table loading progress:', percentage.toFixed(1) + '%');
                    document.getElementById('loadingProgress').style.width = percentage + '%';
                    document.getElementById('loadingText').textContent = `Loading workspace... ${percentage.toFixed(0)}%`;
                }
            },
            function (error) {
                console.log('Table loading failed:', error);
                document.getElementById('loadingScreen').style.display = 'none';
                // Fallback simple table (desk is 2 wide, 1.2 deep)
                const tableGeometry = new THREE.BoxGeometry(2, 0.1, 1.2);
                const tableMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const table = new THREE.Mesh(tableGeometry, tableMaterial);
                table.position.set(0, 0.8, 1.5); // Table surface closer to camera
                scene.add(table);
            }
        );
        
        // Simple monitor on table (warm colored)
        const monitorGeometry = new THREE.BoxGeometry(1.2, 0.5, 0.05);
        const monitorMaterial = new THREE.MeshLambertMaterial({ color: 0x3d2f2a }); // Warm dark brown
        const monitor = new THREE.Mesh(monitorGeometry, monitorMaterial);
        monitor.position.set(0, 0.9, 0.7); // Even lower and shorter
        monitor.castShadow = true;
        scene.add(monitor);
        
        // Add cozy desk items
        // Coffee mug
        const mugGeometry = new THREE.CylinderGeometry(0.08, 0.1, 0.15, 16);
        const mugMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
        const mug = new THREE.Mesh(mugGeometry, mugMaterial);
        mug.position.set(-0.5, 0.93, 1.3);
        mug.castShadow = true;
        scene.add(mug);
        
        
        
        // Books stack
        const bookColors = [0x8B4513, 0x654321, 0x2F4F4F];
        bookColors.forEach((color, i) => {
            const bookGeometry = new THREE.BoxGeometry(0.15, 0.02, 0.1);
            const bookMaterial = new THREE.MeshLambertMaterial({ color });
            const book = new THREE.Mesh(bookGeometry, bookMaterial);
            book.position.set(0.4, 0.87 + (i * 0.025), 1.6);
            book.rotation.y = (Math.random() - 0.5) * 0.3; // Slight random rotation
            book.castShadow = true;
            scene.add(book);
        });
        
        // Pen/pencil
        const penGeometry = new THREE.CylinderGeometry(0.005, 0.005, 0.15, 8);
        const penMaterial = new THREE.MeshLambertMaterial({ color: 0x2F4F4F });
        const pen = new THREE.Mesh(penGeometry, penMaterial);
        pen.position.set(0.2, 0.86, 1.5);
        pen.rotation.z = Math.PI / 2;
        pen.castShadow = true;
        scene.add(pen);
        
        // COZY BEDROOM ENVIRONMENT
        
        // Moon surface floor - much larger and extended forward toward camera
        const floorGeometry = new THREE.PlaneGeometry(80, 80);
        const textureLoader = new THREE.TextureLoader();
        const moonTexture = textureLoader.load('./objects/moon.png');
        moonTexture.wrapS = THREE.RepeatWrapping;
        moonTexture.wrapT = THREE.RepeatWrapping;
        moonTexture.repeat.set(6, 6);
        
        const floorMaterial = new THREE.MeshLambertMaterial({ 
            map: moonTexture,
            transparent: false,
            color: 0xeeeeee // Much brighter
        });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -Math.PI / 2;
        floor.position.set(0, 0, 10); // Shifted forward so more extends toward camera
        floor.receiveShadow = true;
        scene.add(floor);
        
        
        
        
        
        
        
        
        // HTML text editor on monitor
        const textEditorElement = document.createElement('div');
        textEditorElement.innerHTML = `
            <div style="
                width: 400px; 
                height: 300px; 
                background: linear-gradient(145deg, #3a2f2a, #2a1f1a);
                border-radius: 6px;
                border: 2px solid #5a4a3a;
                border-top: 2px solid #7a6a5a;
                border-left: 2px solid #7a6a5a;
                display: flex;
                flex-direction: column;
                box-shadow: 
                    inset 2px 2px 5px rgba(255,255,255,0.1),
                    inset -2px -2px 5px rgba(0,0,0,0.5),
                    0 10px 20px rgba(0,0,0,0.6);
            ">
                <textarea id="textEditor" placeholder="Hey Andrew,

I did a user interview and the person said Notion doesn't feel good because everything's collapsed into one place. Business, personal, personal development, his writing - all just dumped together.

What if instead we had separate workspaces? This desk for focused writing. The neon room for late-night creativity. Maybe a cozy library for research.

Each space holds its own context. No cognitive overload. No mixing business with personal.

Different rooms for different minds.

The opposite of everything-in-one-place.

─ ◆ ─" style="
                    width: 100%;
                    height: 100%;
                    padding: 20px;
                    background: linear-gradient(145deg, #3a2f2a, #2a1f1a);
                    color: #e6d4c4;
                    border: none;
                    font-size: 16px;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    line-height: 1.5;
                    resize: none;
                    outline: none;
                    box-sizing: border-box;
                    overflow-y: scroll;
                    scrollbar-width: thin;
                    scrollbar-color: #8b7355 #2a1f1a;
                "></textarea>
                <style>
                    #textEditor::-webkit-scrollbar {
                        width: 8px;
                        -webkit-appearance: none;
                    }
                    #textEditor::-webkit-scrollbar-track {
                        background: #2a1f1a;
                        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
                    }
                    #textEditor::-webkit-scrollbar-thumb {
                        background: #8b7355;
                        border-radius: 4px;
                        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
                    }
                    #textEditor::-webkit-scrollbar-thumb:hover {
                        background: #a68660;
                    }
                    #textEditor {
                        scrollbar-gutter: stable;
                    }
                </style>
                "></textarea>
            </div>
        `;
        textEditorElement.style.pointerEvents = 'auto';
        
        const css3dObject = new CSS3DObject(textEditorElement);
        css3dObject.position.set(0, 2.5, 0.72); // Much higher and match new monitor Z position
        css3dObject.rotation.x = 0; // No downward angle
        css3dObject.rotation.y = 0; // No side angle  
        css3dObject.rotation.z = 0; // No tilt
        css3dObject.scale.set(0.006, 0.006, 0.006); // Much bigger
        scene.add(css3dObject);
        
        // LocalStorage functionality for text editor
        setTimeout(() => {
            const textEditor = document.getElementById('textEditor');
            if (textEditor) {
                // Load saved text or set default content
                const savedText = localStorage.getItem('cozyDeskText');
                if (savedText) {
                    textEditor.value = savedText;
                } else {
                    // Set the placeholder content as actual text for auto-scroll
                    textEditor.value = textEditor.placeholder;
                }
                
                // Save text on input
                textEditor.addEventListener('input', () => {
                    localStorage.setItem('cozyDeskText', textEditor.value);
                });
                
                // Super slow auto-scroll on first load (if no saved text)
                if (!savedText) {
                    let autoScrollEnabled = true;
                    
                    // Stop auto-scroll if user interacts with scroll
                    textEditor.addEventListener('scroll', () => {
                        autoScrollEnabled = false;
                    });
                    
                    // Stop auto-scroll if user types or clicks
                    textEditor.addEventListener('input', () => {
                        autoScrollEnabled = false;
                    });
                    
                    textEditor.addEventListener('click', () => {
                        autoScrollEnabled = false;
                    });
                    
                    // Force scroll to top FIRST, then focus, then start scrolling
                    setTimeout(() => {
                        if (autoScrollEnabled) {
                            // Force scroll to absolute top multiple times
                            textEditor.scrollTop = 0;
                            textEditor.setSelectionRange(0, 0); // Move cursor to start
                            textEditor.scrollTop = 0; // Force again
                            
                            console.log('Current scrollTop after reset:', textEditor.scrollTop);
                            console.log('ScrollHeight:', textEditor.scrollHeight, 'ClientHeight:', textEditor.clientHeight);
                            
                            // Now focus after positioning
                            textEditor.focus();
                            textEditor.scrollTop = 0; // Force again after focus
                            
                            // Wait another moment, then start scrolling
                            setTimeout(() => {
                                if (autoScrollEnabled) {
                                    console.log('Starting Star Wars style auto-scroll from current position');
                                    
                                    // Very slow auto-scroll down like Star Wars
                                    const autoScroll = () => {
                                        if (autoScrollEnabled && textEditor.scrollTop < textEditor.scrollHeight - textEditor.clientHeight) {
                                            textEditor.scrollTop += 0.5; // Slow scroll down
                                            requestAnimationFrame(autoScroll);
                                        }
                                    };
                                    
                                    // Start scrolling down from current position
                                    autoScroll();
                                }
                            }, 300);
                        }
                    }, 200);
                }
            }
        }, 100);
        
        // 3D Floating Music Player
        const musicPlayerElement = document.createElement('div');
        musicPlayerElement.innerHTML = `
            <div style="
                width: 300px; 
                height: 120px; 
                background: linear-gradient(145deg, #3a2f2a, #2a1f1a);
                border-radius: 15px;
                padding: 20px;
                box-sizing: border-box;
                border: 2px solid #5a4a3a;
                border-top: 2px solid #7a6a5a;
                border-left: 2px solid #7a6a5a;
                box-shadow: 
                    inset 2px 2px 5px rgba(255,255,255,0.1),
                    inset -2px -2px 5px rgba(0,0,0,0.5),
                    0 10px 20px rgba(0,0,0,0.6),
                    0 20px 40px rgba(0,0,0,0.3);
                transform-style: preserve-3d;
                color: white;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
            ">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button id="playPauseBtn" style="
                        width: 60px;
                        height: 60px;
                        border-radius: 50%;
                        background: linear-gradient(145deg, #d4a574, #c19660);
                        border: 2px solid #a67c52;
                        border-top: 2px solid #e6c199;
                        border-left: 2px solid #e6c199;
                        color: white;
                        font-size: 20px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 
                            inset 2px 2px 4px rgba(255,255,255,0.3),
                            inset -2px -2px 4px rgba(0,0,0,0.3),
                            0 6px 15px rgba(212,165,116,0.4),
                            0 3px 8px rgba(0,0,0,0.3);
                        transition: all 0.1s ease;
                        transform-style: preserve-3d;
                    ">⏸</button>
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: bold; margin-bottom: 4px;">Chill Lofi Music</div>
                        <div style="font-size: 12px; opacity: 0.7;">beats to focus/study to</div>
                        <div style="width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 8px;">
                            <div id="progressBar" style="width: 0%; height: 100%; background: #d4a574; border-radius: 2px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        musicPlayerElement.style.pointerEvents = 'auto';
        
        const musicPlayerCSS3D = new CSS3DObject(musicPlayerElement);
        musicPlayerCSS3D.position.set(-2.0, 2.5, 0.72); // Slightly more left
        musicPlayerCSS3D.rotation.x = 0;
        musicPlayerCSS3D.rotation.y = 0; // Same flat orientation as monitor
        musicPlayerCSS3D.rotation.z = 0;
        musicPlayerCSS3D.scale.set(0.004, 0.004, 0.004);
        scene.add(musicPlayerCSS3D);
        
        // Audio setup
        const audio = new Audio('./chill-lofi-music-365921.mp3');
        audio.loop = true;
        audio.volume = 0.3;
        let isPlaying = true;
        
        // Wait for DOM elements to be ready
        setTimeout(() => {
            const playPauseBtn = document.getElementById('playPauseBtn');
            const progressBar = document.getElementById('progressBar');
            
            // Start playing automatically
            audio.play().then(() => {
                console.log('Lofi music started');
            }).catch(e => {
                console.log('Auto-play blocked, click play button');
                isPlaying = false;
                if (playPauseBtn) playPauseBtn.textContent = '▶';
            });
            
            // Play/pause functionality
            if (playPauseBtn) {
                playPauseBtn.addEventListener('click', () => {
                    if (isPlaying) {
                        audio.pause();
                        playPauseBtn.textContent = '▶';
                    } else {
                        audio.play();
                        playPauseBtn.textContent = '⏸';
                    }
                    isPlaying = !isPlaying;
                });
            }
            
            // Progress bar animation
            setInterval(() => {
                if (isPlaying && audio.duration && progressBar) {
                    const progress = (audio.currentTime / audio.duration) * 100;
                    progressBar.style.width = progress + '%';
                }
            }, 100);
        }, 100); // Wait 100ms for DOM elements to be ready
        
        // Animation with smooth camera movement
        function animate() {
            requestAnimationFrame(animate);
            
            // Smooth camera look-at based on mouse
            camera.lookAt(targetLookX, targetLookY, -0.5);
            
            // Animate stars - very gentle rotation
            stars.rotation.x += 0.00005;
            stars.rotation.y += 0.00003;
            
            renderer.render(scene, camera);
            css3dRenderer.render(scene, camera);
        }
        
        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            css3dRenderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        animate();
    </script>
</body>
</html>