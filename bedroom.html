<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Neon Bedroom Workspace</title>
    <style>
        body { margin: 0; background: #0a0a0a; overflow: hidden; }
        
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a, #1a0a1a);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-family: 'Courier New', monospace;
            color: #00ffff;
        }
        
        .loading-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px #00ffff;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .loading-bar {
            width: 300px;
            height: 4px;
            background: rgba(0, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #00ffff;
        }
        
        .loading-text {
            font-size: 0.9rem;
            opacity: 0.8;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <div class="loading-title">⚡ INITIALIZING NEON BEDROOM ⚡</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-text" id="loadingText">Loading environment...</div>
    </div>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.178.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.178.0/examples/jsm/"
        }
    }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a); // Dark neon atmosphere
        
        // Camera positioned INSIDE bedroom - sitting on bed looking at wall-mounted monitor
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0.3, 0.5); // Much lower - actually sitting on bed
        
        // Mouse controls for head movement
        let mouseX = 0, mouseY = 0;
        let targetLookX = 0, targetLookY = 0.5; // Looking at lower wall-mounted monitor
        
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX - window.innerWidth / 2) / window.innerWidth;
            mouseY = (event.clientY - window.innerHeight / 2) / window.innerHeight;
            
            // Subtle head movement
            targetLookX = mouseX * 0.8;
            targetLookY = 0.5 + (mouseY * -0.1);
        });
        
        // WebGL renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        document.body.appendChild(renderer.domElement);
        
        // CSS3D renderer for interactive elements
        const css3dRenderer = new CSS3DRenderer();
        css3dRenderer.setSize(window.innerWidth, window.innerHeight);
        css3dRenderer.domElement.style.position = 'absolute';
        css3dRenderer.domElement.style.top = '0';
        css3dRenderer.domElement.style.pointerEvents = 'none';
        document.body.appendChild(css3dRenderer.domElement);
        
        // Neon bedroom lighting
        const ambientLight = new THREE.AmbientLight(0x4a148c, 0.3); // Purple ambient
        scene.add(ambientLight);
        
        // Main neon light (purple/pink)
        const neonLight1 = new THREE.PointLight(0xff00ff, 1.2, 10);
        neonLight1.position.set(-2, 2.5, -2);
        neonLight1.castShadow = true;
        scene.add(neonLight1);
        
        // Secondary neon light (cyan)
        const neonLight2 = new THREE.PointLight(0x00ffff, 1.0, 8);
        neonLight2.position.set(2, 2, -1);
        neonLight2.castShadow = true;
        scene.add(neonLight2);
        
        // Monitor glow
        const monitorGlow = new THREE.PointLight(0x00ff88, 0.8, 5);
        monitorGlow.position.set(0, 0.5, -1.8);
        scene.add(monitorGlow);
        
        // Load neon bedroom 3D model
        const loader = new GLTFLoader();
        let bedroomLoaded = false;
        
        loader.load(
            './objects/neon_bedroom/scene.gltf',
            function (gltf) {
                console.log('Neon bedroom loaded successfully');
                document.getElementById('loadingText').textContent = 'Loading complete!';
                document.getElementById('loadingProgress').style.width = '100%';
                
                // Hide loading screen after a brief delay
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
                
                const bedroomScene = gltf.scene;
                bedroomScene.position.set(0, 0, 0);
                bedroomScene.scale.set(1, 1, 1);
                bedroomScene.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        // Enhance neon materials
                        if (child.material) {
                            if (child.material.name && child.material.name.includes('neon')) {
                                child.material.emissive = new THREE.Color(0x00ffff);
                                child.material.emissiveIntensity = 0.5;
                            }
                        }
                    }
                });
                scene.add(bedroomScene);
                bedroomLoaded = true;
                
                // Apply skyline texture ONLY to backdrop
                const textureLoader = new THREE.TextureLoader();
                textureLoader.load('./objects/neon_bedroom/textures/Backdrop_diffuse.jpeg', (texture) => {
                    console.log('Skyline texture loaded successfully');
                    texture.flipY = false; // GLTF textures don't need Y-flip
                    bedroomScene.traverse((child) => {
                        if (child.isMesh && child.material) {
                            // Apply ONLY to backdrop material
                            if (child.material.name === 'Backdrop') {
                                console.log('Applying skyline texture to backdrop...');
                                child.material.map = texture;
                                child.material.needsUpdate = true;
                                console.log('Skyline texture applied to backdrop!');
                            }
                        }
                    });
                }, undefined, (error) => {
                    console.log('Failed to load skyline texture:', error);
                });
                
                // Position interactive elements after bedroom loads
                setupInteractiveElements();
            },
            function (progress) {
                if (progress.total > 0) {
                    const percentage = Math.min((progress.loaded / progress.total) * 100, 100);
                    console.log('Bedroom loading progress:', percentage.toFixed(1) + '%');
                    document.getElementById('loadingProgress').style.width = percentage + '%';
                    document.getElementById('loadingText').textContent = `Loading bedroom... ${percentage.toFixed(0)}%`;
                }
            },
            function (error) {
                console.log('Error loading bedroom:', error);
                console.log('Creating fallback bedroom scene');
                createFallbackBedroom();
                setupInteractiveElements();
            }
        );
        
        function createFallbackBedroom() {
            // Simple fallback bedroom if GLTF fails to load
            const floorGeometry = new THREE.PlaneGeometry(10, 10);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x2a2a2a });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Simple bed (where camera sits)
            const bedGeometry = new THREE.BoxGeometry(2, 0.5, 1.8);
            const bedMaterial = new THREE.MeshLambertMaterial({ color: 0x4a4a4a });
            const bed = new THREE.Mesh(bedGeometry, bedMaterial);
            bed.position.set(0, 0.1, 0.5); // Bed positioned where camera is - lower
            bed.castShadow = true;
            scene.add(bed);
        }
        
        function setupInteractiveElements() {
            // Interactive monitor screen (CSS3D) - positioned for optimal bedroom viewing
            const monitorScreenElement = document.createElement('div');
            monitorScreenElement.innerHTML = `
                <div style="
                    width: 600px; 
                    height: 400px; 
                    background: linear-gradient(145deg, #0a0a0a, #1a0a1a);
                    border-radius: 12px;
                    border: 3px solid #ff00ff;
                    border-top: 3px solid #00ffff;
                    border-left: 3px solid #00ffff;
                    display: flex;
                    flex-direction: column;
                    box-shadow: 
                        inset 2px 2px 8px rgba(0,255,255,0.3),
                        inset -2px -2px 8px rgba(255,0,255,0.3),
                        0 15px 40px rgba(255,0,255,0.6),
                        0 0 30px rgba(0,255,255,0.4);
                ">
                    <div style="
                        background: linear-gradient(145deg, #1a0a1a, #0a0a0a);
                        padding: 15px 20px;
                        border-radius: 9px 9px 0 0;
                        color: #00ffff;
                        font-size: 16px;
                        border-bottom: 2px solid #ff00ff;
                        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
                        text-shadow: 0 0 10px #00ffff;
                    ">
                        ⚡ NEON.TERMINAL - BEDROOM_MODE ⚡
                    </div>
                    
                    <textarea id="neonTextEditor" placeholder="Andrew,

I had a lot of fun building this and excited to share with you.

You know how Notion feels heavy? All your work dumped in one sterile place? This is the opposite.

Imagine customizable rooms for thinking. Notes that stick to walls. Radios that work.

The 3D web is wild - we can build entire worlds for focus creativity. Thank you for inspiring me to play and explore. 

Excited to play with you!

─ ◆ ─" style="
                        width: 100%;
                        height: 100%;
                        padding: 25px;
                        background: linear-gradient(145deg, #0a0a0a, #1a0a1a);
                        color: #00ff88;
                        border: none;
                        font-size: 18px;
                        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
                        line-height: 1.7;
                        resize: none;
                        outline: none;
                        box-sizing: border-box;
                        border-radius: 0 0 9px 9px;
                        text-shadow: 0 0 5px #00ff88;
                        overflow-y: scroll;
                        scrollbar-width: thin;
                        scrollbar-color: #00ffff #1a0a1a;
                    "></textarea>
                    <style>
                        #neonTextEditor::-webkit-scrollbar {
                            width: 8px;
                            -webkit-appearance: none;
                        }
                        #neonTextEditor::-webkit-scrollbar-track {
                            background: #1a0a1a;
                            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
                        }
                        #neonTextEditor::-webkit-scrollbar-thumb {
                            background: #00ffff;
                            border-radius: 4px;
                            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
                        }
                        #neonTextEditor::-webkit-scrollbar-thumb:hover {
                            background: #00cccc;
                        }
                        #neonTextEditor {
                            scrollbar-gutter: stable;
                        }
                    </style>
                    "></textarea>
                </div>
            `;
            monitorScreenElement.style.pointerEvents = 'auto';
            
            const css3dMonitor = new CSS3DObject(monitorScreenElement);
            // Position monitor on wall at proper eye level from bed
            css3dMonitor.position.set(0, 0.5, -1.9);
            css3dMonitor.rotation.x = 0;
            css3dMonitor.rotation.y = 0;
            css3dMonitor.rotation.z = 0;
            css3dMonitor.scale.set(0.003, 0.003, 0.003);
            scene.add(css3dMonitor);
            
            // LocalStorage functionality
            setTimeout(() => {
                const textEditor = document.getElementById('neonTextEditor');
                if (textEditor) {
                    const savedText = localStorage.getItem('neonBedroomThoughts');
                    if (savedText) {
                        textEditor.value = savedText;
                    } else {
                        // Set the placeholder content as actual text for auto-scroll
                        textEditor.value = textEditor.placeholder;
                    }
                    
                    textEditor.addEventListener('input', () => {
                        localStorage.setItem('neonBedroomThoughts', textEditor.value);
                    });
                    
                    // Super slow auto-scroll on first load (if no saved text)
                    if (!savedText) {
                        let autoScrollEnabled = true;
                        
                        // Stop auto-scroll if user interacts with scroll
                        textEditor.addEventListener('scroll', () => {
                            autoScrollEnabled = false;
                        });
                        
                        // Stop auto-scroll if user types or clicks
                        textEditor.addEventListener('input', () => {
                            autoScrollEnabled = false;
                        });
                        
                        textEditor.addEventListener('click', () => {
                            autoScrollEnabled = false;
                        });
                        
                        // Force scroll to top FIRST, then focus, then start scrolling
                        setTimeout(() => {
                            if (autoScrollEnabled) {
                                // Force scroll to absolute top multiple times
                                textEditor.scrollTop = 0;
                                textEditor.setSelectionRange(0, 0); // Move cursor to start
                                textEditor.scrollTop = 0; // Force again
                                
                                console.log('Current scrollTop after reset:', textEditor.scrollTop);
                                console.log('ScrollHeight:', textEditor.scrollHeight, 'ClientHeight:', textEditor.clientHeight);
                                
                                // Now focus after positioning
                                textEditor.focus();
                                textEditor.scrollTop = 0; // Force again after focus
                                
                                // Wait another moment, then start scrolling
                                setTimeout(() => {
                                    if (autoScrollEnabled) {
                                        console.log('Starting Star Wars style auto-scroll from current position');
                                        
                                        // Very slow auto-scroll down like Star Wars
                                        const autoScroll = () => {
                                            if (autoScrollEnabled && textEditor.scrollTop < textEditor.scrollHeight - textEditor.clientHeight) {
                                                textEditor.scrollTop += 0.5; // Slow scroll down
                                                requestAnimationFrame(autoScroll);
                                            }
                                        };
                                        
                                        // Start scrolling down from current position
                                        autoScroll();
                                    }
                                }, 300);
                            }
                        }, 200);
                    }
                }
            }, 100);
            
            // Floating neon music player
            const musicPlayerElement = document.createElement('div');
            musicPlayerElement.innerHTML = `
                <div style="
                    width: 320px; 
                    height: 130px; 
                    background: linear-gradient(145deg, #1a0a1a, #0a0a0a);
                    border-radius: 15px;
                    padding: 20px;
                    box-sizing: border-box;
                    border: 3px solid #00ffff;
                    border-top: 3px solid #ff00ff;
                    border-left: 3px solid #ff00ff;
                    box-shadow: 
                        inset 2px 2px 8px rgba(255,0,255,0.3),
                        inset -2px -2px 8px rgba(0,255,255,0.3),
                        0 15px 30px rgba(0,255,255,0.5),
                        0 0 25px rgba(255,0,255,0.4);
                    color: #00ffff;
                    font-family: 'Courier New', monospace;
                ">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button id="neonPlayPauseBtn" style="
                            width: 65px;
                            height: 65px;
                            border-radius: 50%;
                            background: linear-gradient(145deg, #ff00ff, #8000ff);
                            border: 3px solid #00ffff;
                            color: #00ffff;
                            font-size: 20px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 
                                inset 2px 2px 6px rgba(0,255,255,0.4),
                                inset -2px -2px 6px rgba(0,0,0,0.4),
                                0 8px 20px rgba(255,0,255,0.6),
                                0 0 15px rgba(0,255,255,0.4);
                            transition: all 0.1s ease;
                            text-shadow: 0 0 10px #00ffff;
                            pointer-events: auto;
                            z-index: 1000;
                            position: relative;
                        ">⏸</button>
                        <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: bold; margin-bottom: 4px; text-shadow: 0 0 8px #00ffff;">SYNTHWAVE DREAMS</div>
                            <div style="font-size: 11px; opacity: 0.8; text-shadow: 0 0 5px #ff00ff;">// cyberpunk.beats.to.code.by</div>
                            <div style="width: 100%; height: 4px; background: rgba(0,255,255,0.2); border-radius: 2px; margin-top: 8px; border: 1px solid #ff00ff;">
                                <div id="neonProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #00ffff, #ff00ff); border-radius: 2px; box-shadow: 0 0 8px #00ffff;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            musicPlayerElement.style.pointerEvents = 'auto';
            
            const musicPlayerCSS3D = new CSS3DObject(musicPlayerElement);
            musicPlayerCSS3D.position.set(-1.5, 0.5, -1.9); // Slightly more left of wall-mounted monitor
            musicPlayerCSS3D.rotation.x = 0;
            musicPlayerCSS3D.rotation.y = 0;
            musicPlayerCSS3D.rotation.z = 0;
            musicPlayerCSS3D.scale.set(0.0028, 0.0028, 0.0028);
            scene.add(musicPlayerCSS3D);
            
            // Audio setup
            const audio = new Audio('./chill-lofi-music-365921.mp3');
            audio.loop = true;
            audio.volume = 0.25;
            let isPlaying = true;
            
            // Start playing automatically
            audio.play().then(() => {
                console.log('Neon bedroom music started');
            }).catch(e => {
                console.log('Auto-play blocked, click play button');
                isPlaying = false;
            });
            
            // Wait for DOM to be ready, then setup controls
            setTimeout(() => {
                const playPauseBtn = document.getElementById('neonPlayPauseBtn');
                const progressBar = document.getElementById('neonProgressBar');
                
                if (!isPlaying && playPauseBtn) {
                    playPauseBtn.textContent = '▶';
                }
                
                if (playPauseBtn) {
                    console.log('Setting up neon play/pause button');
                    playPauseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        console.log('Neon play/pause clicked, isPlaying:', isPlaying);
                        if (isPlaying) {
                            audio.pause();
                            playPauseBtn.textContent = '▶';
                        } else {
                            audio.play().catch(err => console.log('Play error:', err));
                            playPauseBtn.textContent = '⏸';
                        }
                        isPlaying = !isPlaying;
                    });
                }
                
                setInterval(() => {
                    if (isPlaying && audio.duration && progressBar) {
                        const progress = (audio.currentTime / audio.duration) * 100;
                        progressBar.style.width = progress + '%';
                    }
                }, 100);
            }, 500);
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Smooth camera look-at targeting the monitor area
            camera.lookAt(targetLookX, targetLookY, -1.8);
            
            // Pulsing neon effects
            neonLight1.intensity = 1.2 + Math.sin(Date.now() * 0.003) * 0.3;
            neonLight2.intensity = 1.0 + Math.cos(Date.now() * 0.004) * 0.2;
            monitorGlow.intensity = 0.8 + Math.sin(Date.now() * 0.005) * 0.2;
            
            renderer.render(scene, camera);
            css3dRenderer.render(scene, camera);
        }
        
        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            css3dRenderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        animate();
    </script>
</body>
</html>